---
title: Visual Studio プロジェクトでのプロパティの継承 - C++
description: ネイティブ (MSBuild) Visual Studio C++プロジェクトでのプロパティの継承のしくみ。
ms.date: 02/21/2020
helpviewer_keywords:
- C++ projects, property inheritance
ms.openlocfilehash: 2032ab63c7d278a080742dba8d8d0c6c3ed7a094
ms.sourcegitcommit: 9a63e9b36d5e7fb13eab15c2c35bedad4fb03ade
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/25/2020
ms.locfileid: "77600024"
---
# <a name="property-inheritance-in-visual-studio-projects"></a>Visual Studio プロジェクトでのプロパティの継承

Visual Studio ネイティブプロジェクトシステムは MSBuild に基づいています。 MSBuild では、あらゆる種類のプロジェクトをビルドするためのファイル形式と規則が定義されています。 複数の構成とプラットフォームに対する構築の複雑さの大部分を管理します。 それがどのように動作するかを理解するのに役立ちます。 これは、カスタム構成を定義する場合に特に重要です。 または、複数のプロジェクトに共有してインポートできる、再利用可能なプロパティのセットを作成します。

## <a name="the-vcxproj-file-props-files-and-targets-files"></a>.vcxproj ファイル、.props ファイル、および .targets ファイル

プロジェクトプロパティは、プロジェクトファイル ( *`.vcxproj`* ) に直接格納されるか、プロジェクトファイルによってインポートされ、既定値を提供する他の *`.targets`* または *`.props`* ファイルに格納されます。 Visual Studio 2015 では、これらのファイルは *`\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140`* にあります。 Visual Studio 2017 では、これらのファイルは *`\Program Files (x86)\Microsoft Visual Studio\2017\<edition>\Common7\IDE\VC\VCTargets`* にあります。 *`<edition>`* は、インストールされている visual studio のエディションです。 Visual Studio 2019 では、これらのファイルは *`\Program Files (x86)\Microsoft Visual Studio\2019\<edition>\MSBuild\Microsoft\VC\v160`* にあります。 また、プロパティは、独自のプロジェクトに追加できるカスタム *`.props`* ファイルにも格納されます。 これらのファイルは手動で編集しないことを強くお勧めします。 代わりに、MSBuild について深く理解していない限り、IDE のプロパティページを使用して、すべてのプロパティ (特に継承に参加するプロパティ) を変更します。

前に示したように、同じ構成の同じプロパティに対し、これらの異なるファイルで異なる値を割り当てることができます。 プロジェクトをビルドするとき、MSBuild エンジンは、プロジェクト ファイルとすべてのインポートされたファイルを、適切に定義された順序 (後述) で評価します。 各ファイルが評価されると、そのファイルで定義されているすべてのプロパティ値が、既存の値をオーバーライドします。 指定されていない値は、前に評価されたファイルから継承されます。 プロパティページを使用してプロパティを設定する場合は、設定した場所に注意を払うことも重要です。 *`.props`* ファイルでプロパティを "X" に設定したが、プロジェクトファイルでプロパティが "y" に設定されている場合、プロジェクトはプロパティが "y" に設定された状態でビルドされます。 *`.cpp`* ファイルなどのプロジェクト項目で同じプロパティが "z" に設定されている場合、MSBuild エンジンは "z" 値を使用します。

基本的な継承ツリーを次に示します。

1. MSBuild CPP ツールセットの既定の設定 (..Files\MSBuild\Microsoft.Cpp\v4.0\Microsoft.Cpp.Default.props は、 *`.vcxproj`* ファイルによってインポートされます)。

1. プロパティ シート

1. *`.vcxproj`* ファイル。 (既定値とプロパティ シートの設定をオーバーライド可能)。

1. 項目メタデータ

> [!TIP]
> プロパティページでは、**太字**のプロパティが現在のコンテキストで定義されています。 通常フォントのプロパティが継承されます。

## <a name="view-an-expanded-project-file-with-all-imported-values"></a>インポートされたすべての値を含む展開されたプロジェクト ファイルを表示する

指定したプロパティ値がどのように継承されているかを特定するために、拡張されたファイルを表示すると便利な場合があります。 拡張されたバージョンを表示するには、Visual Studio コマンド プロンプトで次のコマンドを入力します (プレースホルダー ファイル名を適宜変更してください)。

> **msbuild/pp:** **unattend.txt** _myapp_ **.vcxproj**

拡張されたプロジェクトファイルは、MSBuild に習熟している場合を除いて、大きく理解しにくい場合があります。 プロジェクト ファイルの基本的な構造を次に示します。

1. IDE では公開されない基本的なプロジェクトプロパティ。

1. *`Microsoft.cpp.default.props`* のインポート。基本的なツールセットに依存しないプロパティを定義します。

1. グローバル構成プロパティ ( **[Configuration General]\(構成概要\)** ページの **[PlatformToolset]** および **[プロジェクト]** 既定プロパティとして公開されます)。 これらのプロパティは、次の手順で *`Microsoft.cpp.props`* にインポートされるツールセットおよび組み込みプロパティシートを決定します。

1. *`Microsoft.cpp.props`* のインポート。これにより、ほとんどのプロジェクトの既定値が設定されます。

1. *`.user`* ファイルを含むすべてのプロパティシートのインポート。 これらのプロパティ シートは、 **[PlatformToolset]** および **[プロジェクト]** の既定プロパティを除くすべてをオーバーライドできます。

1. 残りのプロジェクト構成プロパティ。 これらの値は、プロパティ シートの設定をオーバーライドできます。

1. 項目 (ファイル) とそのメタデータ。 これらの項目は、他のプロパティやインポートの前に発生した場合でも、常に MSBuild 評価規則の最後の単語です。

詳細については、「[MSBuild プロパティ](/visualstudio/msbuild/msbuild-properties)」を参照してください。

## <a name="build-configurations"></a>ビルドの構成

構成は、名前が与えられたプロパティの任意のグループでしかありません。 Visual Studio には、デバッグ構成とリリース構成が用意されています。 各は、デバッグビルドまたはリリースビルドに対してさまざまなプロパティを適切に設定します。 **Configuration Manager**を使用して、カスタム構成を定義できます。 これらは、特定のフレーバーのビルドに対してプロパティをグループ化するための便利な方法です。

ビルド構成についての理解を深めるには、**プロパティマネージャー**を開きます。 これを開くには、設定に応じて **表示 > プロパティマネージャー**を選択するか、**他の Windows > プロパティマネージャー > 表示**します。 **プロパティマネージャー**には、プロジェクト内の構成とプラットフォームのペアごとにノードがあります。 これらの各ノードの下には、その構成の特定のプロパティを設定するプロパティシート ( *`.props`* ファイル) のノードがあります。

![プロパティ マネージャー](media/property-manager.png "プロパティ マネージャー")

たとえば、プロパティページの [全般] ペインに進むことができます。 文字セット プロパティを Unicode を使用する ではなく 設定なし に変更し、 **OK** をクリックします。 プロパティマネージャーに**Unicode サポート**プロパティシートが表示されなくなりました。 現在の構成では削除されていますが、他の構成ではまだ存在しています。

プロパティ マネージャーおよびプロパティ シートの詳細については、[Visual Studio C++ プロジェクト設定の共有または再利用](create-reusable-property-configurations.md)に関するページを参照してください。

> [!TIP]
> *`.user`* ファイルは従来の機能です。 構成とプラットフォームに従ってプロパティを正しくグループ化するには、削除することをお勧めします。
