---
title: 印刷プレビューのアーキテクチャ
ms.date: 11/04/2016
helpviewer_keywords:
- print preview [MFC], process
- previewing printing
- print preview [MFC], architecture
- printing [MFC], print preview
- print preview [MFC], modifications to MFC
ms.assetid: 0efc87e6-ff8d-43c5-9d72-9b729a169115
ms.openlocfilehash: ea80b67b3f6bb6980e4e8f7f12a967cb7bb5b6c7
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "62218730"
---
# <a name="print-preview-architecture"></a>印刷プレビューのアーキテクチャ

この記事では、MFC フレームワークが印刷プレビュー機能を実装する方法について説明します。 取り上げるトピックは次のとおりです。

- [印刷プレビューの処理](#_core_the_print_preview_process)

- [印刷プレビューの変更](#_core_modifying_print_preview)

印刷プレビューとはやや異なります画面表示と印刷のため、デバイスのイメージを直接描画するには、代わりに、アプリケーションが画面を使用してプリンターをシミュレートする必要があります。 派生する特殊な (文書化されていない) クラスを定義する、Microsoft Foundation Class ライブラリこれに合わせて、 [CDC クラス](../mfc/reference/cdc-class.md)という`CPreviewDC`します。 すべて`CDC`オブジェクトが 2 つのデバイス コンテキストが含まれますが、通常と同じです。 `CPreviewDC`オブジェクト、それらが異なる: 1 つ目がシミュレートされているプリンターを表し、次の出力が表示される実際に画面を表します。

##  <a name="_core_the_print_preview_process"></a> 印刷プレビューの処理

ユーザーが印刷プレビュー を選択すると、**ファイル** メニューの フレームワークを作成、`CPreviewDC`オブジェクト。 アプリケーションでは、プリンター デバイス コンテキストの特性を設定する操作を実行するたびに、フレームワークには画面のデバイス コンテキストで同様の操作も実行します。 など、アプリケーションでは、印刷用のフォントを選択した場合、フレームワークは、プリンター フォントをシミュレートする画面表示のためのフォントを選択します。 アプリケーションは、プリンターに出力を送信、たびに、フレームワークは、画面に出力を代わりに送信します。

印刷プレビューは、ドキュメントのページを描画各順序で印刷からも異なります。 印刷時に、フレームワークは、特定の範囲のページが表示されたまでに、印刷のループを続行します。 印刷のプレビュー期間中いつでも、1 つまたは 2 つのページが表示され、アプリケーションを待ちます。ユーザーが応答するまで、さらにページは表示されません。 印刷のプレビュー期間中は通常の画面表示中と同様、アプリケーションを WM_PAINT メッセージに応答する必要がありますも。

[き](../mfc/reference/cview-class.md#onprepareprinting)関数はプレビュー モードが呼び出されると、印刷ジョブの開始時と同様です。 [CPrintInfo 構造体](../mfc/reference/cprintinfo-structure.md)関数に渡された構造体には、印刷プレビュー操作の特定の特性を調整する設定できる値を持ついくつかのメンバーが含まれています。 たとえば、設定、 *m_nNumPreviewPages*メンバーを 1 ページまたは 2 ページ モードでドキュメントをプレビューするかどうかを指定します。

##  <a name="_core_modifying_print_preview"></a> 印刷プレビューの変更

さまざまな方法で印刷プレビューの外観と動作を簡単に変更できます。 たとえば、することができます、特に。

- ドキュメントの任意のページにアクセスしやすいようにスクロール バーを表示する印刷プレビュー ウィンドウが発生します。

- 現在のページから表示を開始して、ドキュメント内のユーザーの位置を維持するために、印刷プレビューが発生します。

- 印刷と印刷プレビューを実行するさまざまな初期化が発生します。

- 独自の形式でページ番号を表示する印刷プレビューが発生します。

呼び出すし、ドキュメントのどのくらいの時間がいる`SetMaxPage`適切な値を持つフレームワークできる情報を使用してこのプレビュー モードおよび印刷時にします。 フレームワークには、ドキュメントの長さが後、にスクロール バーが、ユーザーがプレビュー モードでドキュメントを複数のページを行き来できるように、[プレビュー] ウィンドウを提供できます。 ドキュメントの長さを設定していない場合、フレームワークをフレームワークがスクロール バーを追加しないように、現在の位置を示すためにスクロール ボックスを配置できません。 この場合、ユーザー必要がありますを使用して、次のページと前のページ ボタン、文書を表示するプレビュー ウィンドウのコントロール バー。

印刷プレビューでは、することが有用かもしれませんに値を割り当てる、 *m_nCurPage*のメンバー`CPrintInfo`場合でも、通常の印刷をそのため決して、します。 通常の印刷中には、このメンバーは、ビュー クラスに、フレームワークからの情報を実行します。 これは、どのフレームワークに指示ビュー ページを印刷する必要があります。

これに対し、印刷プレビュー モードの開始時、 *m_nCurPage*メンバーは、反対方向に情報を保持: フレームワークにビューから。 フレームワークでは、このメンバーの値を使って、どのページを最初にプレビューする必要がありますを決定します。 このメンバーの既定値は 1 は、ドキュメントの最初のページが最初に表示されます。 オーバーライドできます`OnPreparePrinting`印刷プレビュー コマンドが呼び出された時に表示されているページの数にこのメンバーを設定します。 これにより、アプリケーションは、印刷プレビュー モードを通常の表示モードから移動する場合に、ユーザーの現在の位置を保持します。

場合があります`OnPreparePrinting`または印刷プレビューが印刷ジョブの呼び出すかどうかに応じてさまざまな初期化を実行します。 これを調べることで確認できます、*されます*でメンバー変数、`CPrintInfo`構造体。 このメンバーに設定されている**TRUE**印刷プレビューの呼び出し時にします。

`CPrintInfo`構造体は、という名前のメンバーも含まれています。*関数*、これは単一のページに移動し、複数のページのモードでは、画面の下部に表示される文字列を書式設定に使用します。 既定では、これらの文字列がの形式は"ページ*n*"と"ページ*n* - *m*、"を変更できますが、*関数*から内で`OnPreparePrinting`複雑なものに、文字列を設定します。 参照してください[CPrintInfo 構造体](../mfc/reference/cprintinfo-structure.md)で、 *MFC リファレンス*詳細についてはします。

## <a name="see-also"></a>関連項目

[[印刷と印刷プレビュー]](../mfc/printing-and-print-preview.md)<br/>
[印刷](../mfc/printing.md)<br/>
[CView クラス](../mfc/reference/cview-class.md)<br/>
[CDC クラス](../mfc/reference/cdc-class.md)
