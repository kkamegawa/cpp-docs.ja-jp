---
title: 登録
ms.date: 11/04/2016
helpviewer_keywords:
- servers [MFC], initializing
- initializing servers [MFC]
- OLE, registration
- installing servers [MFC]
- registry [MFC], OLE item database
- registration databases [MFC]
- servers [MFC], installing
- OLE server applications [MFC], registering servers
ms.assetid: 991d5684-72c1-4f9e-a09a-9184ed12bbb9
ms.openlocfilehash: 0bc606acfba26d27d0ab36045e4772593e760e98
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "62309099"
---
# <a name="registration"></a>登録

ユーザーがアプリケーションに OLE 項目を挿入しようとすると、OLE から選択するオブジェクトの種類の一覧が表示されます。 OLE では、すべてのサーバー アプリケーションによって提供される情報を含むシステムの登録情報データベースからこの一覧を取得します。 を、サーバーが自身を登録する場合、そのシステムの登録データベース (レジストリ) に保存されますエントリは提供オブジェクトの種類ごとの説明、、ファイルの拡張機能、およびその他の情報自体へのパス。

フレームワークと OLE システム ダイナミック リンク ライブラリ (DLL) は、このレジストリを使用して、OLE 項目の種類は、システムで使用できるかを判断します。 OLE システム Dll もこのレジストリを使用してリンクまたは埋め込みオブジェクトがアクティブ化されるときに、サーバー アプリケーションを起動する方法を決定します。

この記事では、各サーバー アプリケーションの必要がインストールされている場合の対処方法について説明し、毎回実行されます。

システムの登録データベースと更新に使用される .reg ファイルの形式の詳細については、次を参照してください。、 *OLE プログラマーズ リファレンス*します。

##  <a name="_core_server_installation"></a> サーバーのインストール

最初に、サーバー アプリケーションをインストールするときにそれがサポートする OLE 項目のすべての種類を登録する必要があります。 サーバーをスタンドアロン アプリケーションとして実行するたびに、システムの登録情報データベースを更新することもできます。 これにより、登録情報データベース最新の状態、サーバーの実行可能ファイルが移動された場合。

> [!NOTE]
>  アプリケーション ウィザードによって自動的に生成された MFC アプリケーションはスタンドアロン アプリケーションとして実行された場合に自身を登録します。

インストール中にアプリケーションを登録する場合は、RegEdit.exe プログラムを使用します。 セットアップ プログラムの実行がある場合は、アプリケーションのセットアップ プログラムを含めると、"RegEdit/S *appname*.reg"。 (/S フラグは、サイレントの操作を示します、つまり、そのコマンドが正常に完了を報告 ダイアログ ボックスに表示されません。)それ以外の場合、RegEdit を手動で実行するユーザーに指示します。

> [!NOTE]
>  アプリケーション ウィザードで作成した .reg ファイルでは、実行可能ファイルの完全なパスは含まれません。 インストール プログラムは、実行可能ファイルへの完全パスを含めるか、インストール ディレクトリを含めるパス環境変数の変更を .reg ファイルを変更する必要がありますか。

RegEdit では、登録情報データベースに .reg テキスト ファイルの内容をマージします。 データベースを確認します。 または、それを修復するには、レジストリ エディターを使用します。 OLE の基本エントリが削除されないように注意してください。

##  <a name="_core_server_initialization"></a> サーバーの初期化

アプリケーション ウィザードを使用してサーバー アプリケーションを作成するときに、ウィザードが完了したらすべての初期化タスクを自動的にします。 このセクションでは、必要な作業がサーバー アプリケーションを手動で作成する場合について説明します。

コンテナー アプリケーションをサーバー アプリケーションを起動すると、OLE システム Dll は、サーバーのコマンドラインに「/埋め込み」オプションを追加します。 サーバー アプリケーションの動作は、まず、アプリケーションが実行を開始するときに行う必要がありますが確認のため、コンテナー、によって起動されたかどうかによって異なります、「/埋め込み」または"-埋め込み"コマンド ライン オプション。 このスイッチが存在する場合は、異なる一連のいずれか、インプレース アクティブ サーバーを表示するリソースを読み込むか、完全を開きます。 詳細については、次を参照してください。[メニューとリソース。Server Additions](../mfc/menus-and-resources-server-additions.md)します。

サーバー アプリケーションが呼び出す必要がありますもその`CWinApp::RunEmbedded`コマンドラインを解析する関数。 0 以外の値を返された場合、アプリケーションする必要がありますウィンドウを表示できませんが、スタンドアロン アプリケーションとしてではなく、コンテナーのアプリケーションから実行されているためです。 この関数は、システムの登録データベース呼び出しで、サーバーのエントリを更新、`RegisterAll`メンバー関数のインスタンスを登録します。

サーバー アプリケーションの起動時には、インスタンスの登録を実行できることを確認する必要があります。 インスタンスの登録では、サーバーがアクティブでコンテナーから要求を受信する準備ができている OLE システム Dll を通知します。 登録情報データベースにエントリは追加されません。 呼び出して、サーバーのインスタンスの登録を実行、`ConnectTemplate`によって定義されたメンバー関数`COleTemplateServer`します。 これにより接続、`CDocTemplate`オブジェクトを`COleTemplateServer`オブジェクト。

`ConnectTemplate`関数は 3 つのパラメーターを受け取ります。 サーバーの*CLSID*、へのポインター、`CDocTemplate`オブジェクト、および、サーバーが複数のインスタンスをサポートしているかどうかを示すフラグ。 ミニサーバーは複数のインスタンスをサポートできる必要があります、つまりできる必要がある同時に、コンテナーごとに 1 つを実行するサーバーの複数のインスタンス。 したがって、渡す**TRUE**ミニサーバーを起動するときにこのフラグを使用します。

定義上は常にコンテナーが起動されますミニサーバーを作成する場合。 「/埋め込み」オプションを確認するためのコマンドラインを解析することも必要があります。 コマンドラインでこのオプションがない場合は、ユーザーが、スタンドアロン アプリケーションとしてミニサーバーを起動しようとしたことを意味します。 このような場合は、システム登録データベース、サーバーに登録され、ミニサーバー コンテナー アプリケーションを起動するユーザーに知らせるメッセージ ボックスが表示されます。

## <a name="see-also"></a>関連項目

[OLE](../mfc/ole-in-mfc.md)<br/>
[サーバー](../mfc/servers.md)<br/>
[CWinApp::RunAutomated](../mfc/reference/cwinapp-class.md#runautomated)<br/>
[CWinApp::RunEmbedded](../mfc/reference/cwinapp-class.md#runembedded)<br/>
[COleTemplateServer クラス](../mfc/reference/coletemplateserver-class.md)
