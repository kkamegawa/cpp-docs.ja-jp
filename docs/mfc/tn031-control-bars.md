---
title: TN031:コントロール バー
ms.date: 11/04/2016
f1_keywords:
- vc.controls.bars
helpviewer_keywords:
- control bars [MFC], styles
- CStatusBar class [MFC], Tech Note 31 usage
- CControlBar class [MFC], Tech Note 31 usage
- CControlBar class [MFC], deriving from
- control bars [MFC], classes [MFC]
- CDialogBar class [MFC], Tech Note 31 usage
- CToolBar class [MFC], Tech Note 31 usage
- TN031
- styles [MFC], control bars
ms.assetid: 8cb895c0-40ea-40ef-90ee-1dd29f34cfd1
ms.openlocfilehash: 39309408c6d1fc6cbb4223eda22c511865f14498
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "62305634"
---
# <a name="tn031-control-bars"></a>TN031:コントロール バー

> [!NOTE]
>  次のテクニカル ノートは、最初にオンライン ドキュメントの一部とされてから更新されていません。 結果として、一部のプロシージャおよびトピックが最新でないか、不正になります。 最新の情報について、オンライン ドキュメントのキーワードで関係のあるトピックを検索することをお勧めします。

このメモは、MFC でのコントロール バー クラスをについて説明します一般的な[CControlBar](#_mfcnotes_ccontrolbar)、 [CStatusBar](#_mfcnotes_cstatusbar)、 [CToolBar](#_mfcnotes_ctoolbar)、 [CDialogBar](#_mfcnotes_cdialogbar)、および`CDockBar`。

## <a name="_mfcnotes_ccontrolbar"></a> CControlBar

A`ControlBar`は、 `CWnd`-派生クラスです。

- フレーム ウィンドウの上部または下部に配置されます。

- 子項目として、HWND ベースのコントロール ( `CDialogBar`など) または`HWND` ベースではない項目 ( `CToolBar`、 `CStatusBar`など) のいずれかを含むことができます。

コントロール バーでは、次の追加スタイルがサポートされています。

- CBRS_TOP (既定値) pin を先頭にコントロール バーです。

- CBRS_BOTTOM コントロール バーを下部にあるピン留めします。

- 親のサイズ変更時にコントロール バーを再配置 CBRS_NOALIGN はされません。

`CControlBar` からの派生クラスには、次のような、さらに興味深い実装が用意されています。

- `CStatusBar` : ステータス バー。項目はテキストを含むステータス バー ペインです。

- `CToolBar` : ツール バー。項目は 1 列に配置されたビットマップ ボタンです。

- `CDialogBar` : 標準ウィンドウ コントロールを含む、ツール バーに似たフレーム (ダイアログ テンプレート リソースから作成できます)。

- `CDockBar` その他の汎用ドッキング領域`CControlBar`派生オブジェクト。 このクラスで利用できる特定のメンバー関数および変数は、今後のリリースで変更される可能性があります。

すべてのコントロール バー オブジェクト/ウィンドウが、一部の親フレーム ウィンドウの子ウィンドウになります。 これらは通常、フレームのクライアント領域 (たとえば、MDI クライアントまたはビュー) に兄弟として追加されます。 コントロール バーの子ウィンドウ ID は重要な ID です。 コントロール バーの既定のレイアウトは AFX_IDW_CONTROLBAR_LAST に AFX_IDW_CONTROLBAR_FIRST の範囲の Id を持つコントロール バーに対してのみ機能します。 コントロール バー ID の範囲が 256 まである場合でも、最初の 32 までは特殊なコントロール バー ID です (印刷プレビューのアーキテクチャによって直接サポートされるため)。

`CControlBar` クラスには、次の目的に利用できる標準実装が用意されています。

- コントロール バーをフレームの上部、下部、左側、または右側に配置する。

- コントロール項目の配列を割り当てる。

- 派生クラスの実装をサポートする。

通常、C++ コントロール バー オブジェクトは `CFrameWnd` 派生クラスのメンバーとして埋め込まれ、親の `HWND` とオブジェクトが破棄された場合にはクリーンアップされます。 ヒープ上にコントロール バー オブジェクトを割り当てる必要がある場合は、 *が破棄されたときにコントロール バーが "* delete this **" を実行するように、** m_bAutoDestruct**メンバーを**TRUE `HWND` に設定します。

> [!NOTE]
>  独自に作成する場合`CControlBar`-など、クラスの派生の MFC のいずれかを使用するのではなく、派生クラスで`CStatusBar`、 `CToolBar`、または`CDialogBar`を設定する必要があります、 *m_dwStyle*データ メンバー。 これは、オーバーライドで実行できます`Create`:

```
// CMyControlBar is derived from CControlBar
BOOL CMyControlBar::Create(CWnd* pParentWnd,
    DWORD dwStyle,
    UINT nID)
{
    m_dwStyle = dwStyle;

.
.
.
}
```

**コントロール バー レイアウトのアルゴリズム**

コントロール バー レイアウトのアルゴリズムは非常に単純です。 フレーム ウィンドウは、コントロール バーの範囲内のすべての子に WM_SIZEPARENT メッセージを送信します。 このメッセージと共に、親のクライアント領域の四角形を指すポインターが渡されます。 このメッセージは、Z オーダーで子に送信されます。 コントロール バーの子は、この情報を使用して自身を配置し、親のクライアント領域のサイズを縮小します。 通常のクライアント領域用に残された最後の四角形 (コントロール バー以外の領域) は、メイン クライアント ウィンドウ (通常は MDI クライアント、ビュー、または分割ウィンドウ) を配置するために使用されます。

詳細については、「 `CWnd::RepositionBars` 」と「 `CFrameWnd::RecalcLayout` 」を参照してください。

WM_SIZEPARENT を含む MFC プライベート Windows メッセージに記載されて[テクニカル ノート 24](../mfc/tn024-mfc-defined-messages-and-resources.md)します。

## <a name="_mfcnotes_cstatusbar"></a>  CStatusBar

ステータス バーとは、テキスト出力ペインの行を持つコントロール バーです。 テキスト出力ペインの使用方法としては、次の 2 つの方法が一般的です。

- メッセージ行として使用する方法

     (たとえば、標準メニューのヘルプ メッセージ行)。 通常、これらのメッセージ行には 0 から始まるインデックスによってアクセスします。

- ステータス インジケーターとして使用する方法

     (たとえば、CAP、NUM、および SCRL インジケーター)。 通常、これらのインジケーターには文字列/コマンド ID によってアクセスします。

ステータス バーのフォントは 10 ポイント MS P ゴシックです (Windows インターフェイス アプリケーション デザイン ガイド、またはフォント マッパーにより 10 ポイント Swiss プロポーショナル フォントに最適なフォントとして指定)。 日本語版など、特定のバージョンの Windows では、選択されるフォントが異なります。

ステータス バーで使用される色は、Windows インターフェイス アプリケーション デザイン ガイドの推奨事項にも適合しています。 これらの色はハード コーディングされていないため、コントロール パネルでのユーザーによるカスタマイズに応じて動的に変化します。

|アイテム|Windows COLOR 値|既定の RGB|
|----------|-------------------------|-----------------|
|ステータス バーの背景|COLOR_BTNFACE|RGB (192, 192, 192)|
|ステータス バーのテキスト|COLOR_BTNTEXT|RGB (000, 000, 000)|
|ステータス バーの上端/左端|COLOR_BTNHIGHLIGHT|RGB (255, 255, 255)|
|ステータス バーの下端/右端|COLOR_BTNSHADOW|RGB (128, 128, 128)|

**CStatusBar 用の CCmdUI のサポート**

インジケーターが更新される通常の方法は ON_UPDATE_COMMAND_UI メカニズムです。 アイドル時、ステータス バーはインジケーター ペインの文字列 ID を持つ ON_UPDATE_COMMAND_UI ハンドラーを呼び出します。

ON_UPDATE_COMMAND_UI ハンドラーを呼び出すことができます。

- `Enable`:有効または、ウィンドウを無効にします。 無効なペインの見た目は有効なペインとまったく同じですが、テキストが非表示になります (つまり、テキスト インジケーターが無効になります)。

- `SetText`:テキストを変更します。 これを使用する場合は、ペインのサイズが自動的に変更されない点に注意してください。

[の作成およびカスタマイズ API の詳細については、](../mfc/reference/cstatusbar-class.md) クラス ライブラリ リファレンス *の* CStatusBar `CStatusBar` クラスを参照してください。 ステータス バーのカスタマイズの大部分は、ステータス バーの初回表示前に行う必要があります。

ステータス バーでは、可変幅ペインが 1 つだけサポートされており、通常は最初のペインがこれにあたります。 このペインのサイズは、実際には最小サイズです。 ステータス バーがすべてのペインの最小サイズより大きい場合、余分な幅は可変幅ペインに与えられます。 ステータス バーを持つ既定のアプリケーションは、最初のペインが可変幅であるため、CAP、NUM、および SCRL 用のインジケーターが右揃えになります。

## <a name="_mfcnotes_ctoolbar"></a>  CToolBar

ツール バーとは、ビットマップ ボタンの行を持つコントロール バーであり、区分線を含むことができます。 プッシュ ボタンとチェック ボックス ボタンという 2 つのスタイルがサポートされます。 オプション グループ機能は、チェック ボックス ボタンおよび ON_UPDATE_COMMAND_UI で構築できます。

ツール バー内のすべてのビットマップ ボタンは、1 つのビットマップから取得します。 このビットマップには、ボタンごとに 1 つの画像またはグリフが含まれている必要があります。 通常、ビットマップ内の画像/グリフの順序は、画面に描画される順序と同じです (この順序はカスタマイズ API を使用して変更できます)。

各ボタンは同じサイズにする必要があります。 既定値は標準の 24 x 22 ピクセルです。 各画像/グリフは同じサイズにする必要があり、ビットマップ内で横並びに配置する必要があります。 既定の画像/グリフのサイズは 16 x 15 ピクセルです。 そのため、10 個のボタンを持つツール バー (標準サイズを使用) には、幅 160 ピクセル、高さ 15 ピクセルのビットマップが必要です。

各ボタンは、画像/グリフを 1 つだけ持ちます。 ボタンのさまざまな状態とスタイル (押されている状態、アップ状態、ダウン状態、無効な状態、無効なダウン状態、不確定状態など) は、その 1 つの画像/グリフからアルゴリズムによって生成されます。 理論上は、どのような色のビットマップや DIB でも使用できます。 ボタンのさまざまな状態を生成するためのアルゴリズムは、元の画像がグレースケールの場合に最も効果的に機能します。 参考例については、MFC 標準サンプルの [CLIPART](../overview/visual-cpp-samples.md) で提供されている標準ツール バー ボタンとツール バー ボタン クリップアートを参照してください。

ツール バーで使用される色は、Windows インターフェイス アプリケーション デザイン ガイドの推奨事項にも適合しています。 これらの色はハード コーディングされていないため、コントロール パネルでのユーザーによるカスタマイズに応じて動的に変化します。

|アイテム|Windows COLOR 値|既定の RGB|
|----------|-------------------------|-----------------|
|ツール バーの背景|COLOR_BTNFACE|RGB (192, 192, 192)|
|ツール バー ボタンの上端/左端|COLOR_BTNHIGHLIGHT|RGB (255, 255, 255)|
|ツール バー ボタンの下端/右端|COLOR_BTNSHADOW|RGB (128, 128, 128)|

また、ツール バーのビットマップ ボタンの色は、それが標準 Windows ボタン コントロールであるかのように塗り直されます。 この色の変更は、ビットマップがリソースから読み込まれたときに発生するほか、コントロール パネルでのユーザーによるカスタマイズに応じてシステム カラーの変更が行われた場合にも発生します。 ツール バーのビットマップに次の色が含まれている場合、その色は自動的に変更されるため、注意して使用する必要があります。 ビットマップの色が部分的に変更されることが好ましくない場合は、マップされた RGB 値に近い色を使用してください。 マッピングは正確な RGB 値に基づいて行われます。

|RGB 値|動的にマップされた COLOR 値|
|---------------|------------------------------------|
|RGB (000, 000, 000)|COLOR_BTNTEXT|
|RGB (128, 128, 128)|COLOR_BTNSHADOW|
|RGB (192, 192, 192)|COLOR_BTNFACE|
|RGB (255, 255, 255)|COLOR_BTNHIGHLIGHT|

[の作成およびカスタマイズ API の詳細については、](../mfc/reference/ctoolbar-class.md) クラス ライブラリ リファレンス *の* CToolBar `CToolBar` クラスを参照してください。 ツール バーのカスタマイズの大部分は、ツール バーの初回表示前に行う必要があります。

カスタマイズ API を使用すると、ボタン ID、スタイル、スペーサー幅のほか、どのボタンに対してどの画像/グリフを使用するかを調整できます。 既定では、これらの API を使用する必要はありません。

## <a name="ccmdui-support-for-ctoolbar"></a>CToolBar 用の CCmdUI のサポート

ツールバーのボタンは常に更新される方法は ON_UPDATE_COMMAND_UI メカニズムです。 アイドル時、ツールバーはそのボタンのコマンド ID を持つ ON_UPDATE_COMMAND_UI ハンドラーを呼び出します。 ON_UPDATE_COMMAND_UI は、区切り記号には呼び出されませんが、プッシュ ボタンとチェック ボックス ボタンに対して呼び出されます。

ON_UPDATE_COMMAND_UI ハンドラーを呼び出すことができます。

- `Enable`:有効または、ボタンを無効にします。 これはプッシュ ボタンでもチェック ボックス ボタンでも同様に機能します。

- `SetCheck`:ボタンのチェックの状態を設定します。 これをツール バーのボタンに対して呼び出すと、そのボタンがチェック ボックス ボタンに変わります。 `SetCheck` には、パラメーターとして 0 (オフ)、1 (オン)、または 2 (不確定) を指定できます。

- `SetRadio`:短縮形`SetCheck`します。

チェック ボックス ボタンは "AUTO" チェック ボックス ボタンです。つまり、ユーザーがそのボタンを押すと、すぐにボタンの状態が変化します。 オン状態は、ダウン状態または押されている状態です。 組み込みのユーザー インターフェイスには、ボタンを "不確定" 状態に変更する方法はありません。この操作はコードを通じて実行する必要があります。

カスタマイズ Api は、特定のツール バー ボタンの状態を変更することを許可する、可能であれば、これらのツール バー ボタンを表すコマンドに対する状態を変更する必要があります。 SetButtonStyle を通じてこれらの状態への変更は、次失わ取得可能性があります、アイドル状態の処理のでは、ツール バー ボタンの状態が変化することを忘れないでくださいアイドル状態です。

WM_COMMAND メッセージなどの通常のボタンまたはメニュー項目と ON_UPDATE_COMMAND_UI ハンドラーを提供するクラスと同じクラスには、通常は、ツールバーのボタンを使うことをお送りします。

ツール バーのボタンには 4 つのスタイル (TBBS_ 値) があり、次の状態を表示するために使用されます。

- TBBS_CHECKED: 現在はチェック ボックスをオン (ダウン)。

- TBBS_INDETERMINATE: チェック ボックスは現在、不確定です。

- TBBS_DISABLED: ボタンは現在無効になります。

- TBBS_PRESSED: ボタンが現在押されています。

公式の Windows インターフェイス アプリケーション デザイン ガイドによる 6 種類のボタン スタイルは、次の TBBS 値で表されます。

- Up = 0

- マウス ダウン = TBBS_PRESSED (&#124;その他のスタイル)

- Disabled (無効) = TBBS_DISABLED

- Down (ダウン) = TBBS_CHECKED

- ダウン、無効 = TBBS_CHECKED &#124; TBBS_DISABLED

- Indeterminate (不確定) = TBBS_INDETERMINATE

##  <a name="_mfcnotes_cdialogbar"></a> CDialogBar

ダイアログ バーとは、標準の Windows コントロールが含まれるコントロール バーです。 ダイアログと同様にコントロールが含まれ、コントロール間でのタブ移動をサポートします。 また、バーを表すためにダイアログ テンプレートを使用する点もダイアログと同様です。

`CDialogBar` は、標準のプッシュ ボタン コントロールを含む印刷プレビュー ツール バーに使用されています。

`CDialogBar` は、 `CFormView`と同じような方法で使用します。 ダイアログ バー用のダイアログ テンプレートを定義し、WS_CHILD を除くすべてのスタイルを削除する必要があります。 ダイアログは表示することができない点に注意してください。

`CDialogBar` のコントロール通知はコントロール バーの親に送信されます (ツール バーのボタンと同様)。

## <a name="ccmdui-support-for-cdialogbar"></a>CDialogBar 用の CCmdUI のサポート

ON_UPDATE_COMMAND_UI ハンドラーのメカニズムでは、ダイアログ バーのボタンを更新する必要があります。 アイドル状態時に、ダイアログ バーが、ID を持つすべてのボタンのコマンド ID を持つ ON_UPDATE_COMMAND_UI ハンドラーを呼び出す > 0x8000 (つまり、コマンド Id の範囲で)。

ON_UPDATE_COMMAND_UI ハンドラーを呼び出すことができます。

- Enable: ボタンを有効または無効にします。

- SetText: ボタンのテキストを変更します。

カスタマイズは、標準ウィンドウ マネージャー API を使用して行うことができます。

## <a name="see-also"></a>関連項目

[番号順テクニカル ノート](../mfc/technical-notes-by-number.md)<br/>
[カテゴリ別テクニカル ノート](../mfc/technical-notes-by-category.md)
