---
title: TN040:MFC OLE インプレースでサイズ変更とズーム
ms.date: 11/04/2016
helpviewer_keywords:
- resizing in-place
- TN040
- zooming and in-place activation
- in-place activation, zooming and resizing
ms.assetid: 4d7859bd-0b2e-4254-be62-2735cecf02c6
ms.openlocfilehash: 9d5c87e6d5daff34a479ba61c0c275b48a8bba4d
ms.sourcegitcommit: 934cb53fa4cb59fea611bfeb9db110d8d6f7d165
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/14/2019
ms.locfileid: "65611115"
---
# <a name="tn040-mfcole-in-place-resizing-and-zooming"></a>TN040:MFC/OLE 埋め込み先サイズ変更とズーム

> [!NOTE]
>  次のテクニカル ノートは、最初にオンライン ドキュメントの一部とされてから更新されていません。 結果として、一部のプロシージャおよびトピックが最新でないか、不正になります。 最新の情報について、オンライン ドキュメントのキーワードで関係のあるトピックを検索することをお勧めします。

この注は、埋め込み先編集に関連する問題と方法、server する必要があります正しいズームを行う埋め込み先サイズ変更について説明します。 インプレース アクティブ化で、WYSIWYG の概念にはそのコンテナーで 1 つの手順をさらが取得され、サーバーが相互の連携し同様に、ほぼ OLE 仕様を具体的には解釈。

コンテナーとサーバーのインプレース アクティブ化をサポートしている間、対話のためには、さまざまな保持する必要があるエンドユーザーからの期待があります。

- プレゼンテーションの表示 (で描画するメタファイル、`COleServerItem::OnDraw`上書き) する必要があります、まったく同じとして描画 (準じた編集ツールには表示されません) を編集するため。

- コンテナーが拡大とサーバー ウィンドウはすぎるください!

- コンテナーとサーバーの両方が同じメトリックを使用してオブジェクトを表示する必要があります。 つまり、数に基づくマッピング モードを使用して*論理*ピクセル/インチ-物理ピクセル/インチ、ディスプレイ デバイスに表示するときにします。

> [!NOTE]
>  インプレース アクティブ化は、埋め込まれている (リンクされていない) 項目にのみ適用される、ためにはズーム埋め込みオブジェクトにのみ適用されます。 両方の Api が表示されます`COleServerDoc`と`COleServerItem`ズームに使用します。 リンクと埋め込みの両方の項目に対して有効な関数だけが中はこの二分のため`COleServerItem`(これにより、一般的な実装を使用) には埋め込みオブジェクトに対してのみ有効な関数が存在し、 `COleServerDoc`クラス (サーバーの観点からは、**ドキュメント**が埋め込まれている)。

負担の大部分で、サーバーをコンテナーの倍率に注意してください、必要に応じて編集インターフェイスを変更する必要があります、サーバーの実装に配置されます。 サーバーがコンテナーを使用してズームの倍率に決定します。

## <a name="mfc-support-for-zooming"></a>ズームの MFC サポート

現在のズームの倍率を呼び出すことによって決まりますできます`COleServerDoc::GetZoomFactor`します。 ドキュメントがアクティブでないときにこの関数を呼び出すが常に 100% ズーム要素 (または 1 対 1 の比率) で発生します。 呼び出すと、インプレース アクティブは、100% 以外のものを返す可能性があります。

ズームを正しくの例については、MFC OLE サンプルを参照してください。 [HIERSVR](../overview/visual-cpp-samples.md)します。 ズーム イン HIERSVR では、テキストを表示し、テキスト、一般はスケールインされません (ヒント、表記規則、設計の幅および高さのすべての問題を複雑になります)、直線的で複雑になります。 それでも、HIERSVR はズームを正しく実装するための適切な参照と MFC のチュートリアルは[SCRIBBLE](../overview/visual-cpp-samples.md) (手順 7)。

`COleServerDoc::GetZoomFactor` さまざまなコンテナーから、またはの実装から別のメトリックに基づく倍率を決定、`COleServerItem`と`COleServerDoc`クラス。 つまり、現在のズームの倍率は次の式によって決定されます。

```
Position Rectangle (PR) / Container Extent (CE)
```

位置四角形は、コンテナーによって決定されます。 インプレース アクティブ化中に、サーバーに返されるときに`COleClientItem::OnGetItemPosition`と呼びます。 コンテナーは、サーバーのを呼び出すときに更新`COleServerDoc::OnSetItemRects`(への呼び出しで`COleClientItem::SetItemRects`)。

コンテナーのエクステントを計算する少し複雑です。 コンテナーが呼び出された場合`COleServerItem::OnSetExtent`(への呼び出しで`COleClientItem::SetExtent`)、コンテナーのエクステントはこの値を論理インチあたりのピクセルの数に基づくピクセルに変換します。 コンテナーが SetExtent (これは通常のケース) 場合は、呼び出されていない場合は、コンテナー エクステントから返されたサイズ`COleServerItem::OnGetExtent`します。 そのため、コンテナーに SetExtent が呼び出されていない場合、framework 前提としていましている場合は、コンテナーということが 100% の自然なエクステントの (から返される値`COleServerItem::GetExtent`)。 別の方法を説明したフレームワークでは、コンテナーの項目の 100% (でない) が表示されている前提としています。

ですが注意することが重要`COleServerItem::OnSetExtent`と`COleServerItem::OnGetExtent`名前が似ている項目の同じ属性を操作しません。 `OnSetExtent` サーバーのオブジェクトの量が (ズームの倍率) に関係なく、コンテナー内に表示されているために呼び出されると`OnGetExtent`はオブジェクトの理想的なサイズを決定するコンテナーによって呼び出されます。

各 Api の関連する問題を調べることで、わかりやすい画像を取得できます。

## <a name="coleserveritemongetextent"></a>COleServerItem::OnGetExtent

この関数は、HIMETRIC 単位の項目の「自然なサイズ」を返す必要があります。 「自然なサイズ」と考える最善の方法では、印刷時に表示されるサイズとして定義します。 ここで返されるサイズでは、(特定のアイテムの定数は、メタファイル同様)、特定の項目の内容の定数です。 ズームを項目に適用すると、このサイズは変わりません。 通常は変更されません、コンテナーは呼び出すことによって、アイテム詳細以下の領域が`OnSetExtent`します。 変更の例に、コンテナーによって送信された最後のエクステントに基づいてテキストを折り返して「余白」容量がない単純なテキスト エディターのことがあります。 サーバーは、システム レジストリ内のビット OLEMISC_RECOMPOSEONRESIZE を設定しておそらくサーバーが変更されると場合、(このオプションの詳細については、OLE SDK ドキュメントを参照してください)。

## <a name="coleserveritemonsetextent"></a>COleServerItem::OnSetExtent

コンテナーが「増減」オブジェクトの表示するときに、この関数が呼び出されます。 ほとんどのコンテナーは呼び出しませんこれですべてです。 既定の実装で使用されている 'です' のコンテナーから受信した最後の値を格納する`COleServerDoc::GetZoomFactor`上記で説明したコンテナーの範囲の値を計算するときにします。

## <a name="coleserverdoconsetitemrects"></a>COleServerDoc::OnSetItemRects

ドキュメントがアクティブである場合にのみ、この関数が呼び出されます。 コンテナー項目の位置またはアイテムに適用される領域のいずれかを更新するときに呼び出されます。 位置四角形、前述のとおりは、ズームの係数の計算の分子を提供します。 サーバーが呼び出すことで、項目の位置を変更することを要求することができます`COleServerDoc::RequestPositionChange`します。 コンテナーのことがありますまたは呼び出すことによってこの要求に応答しない可能性があります`OnSetItemRects`(への呼び出しで`COleServerItem::SetItemRects`)。

## <a name="coleserverdocondraw"></a>COleServerDoc::OnDraw

オーバーライドすることで、メタファイルが作成されたことを実現することが重要`COleServerItem::OnDraw`現在のズームの倍率に関係なく、まったく同じメタファイルを生成します。 コンテナーは、適切なメタファイルを拡大縮小されます。 これは、ビューの間で重要な違いは`OnDraw`とサーバー項目の`OnDraw`します。 ズーム ビュー ハンドル、項目が作成した、*ズーム可能な*メタファイルし適切なズームを行うコンテナーまでのままにします。

実装を使用する、サーバーが正しく動作することを確認する最善の方法は、`COleServerDoc::GetZoomFactor`ドキュメントがアクティブである場合。

## <a name="mfc-support-for-in-place-resizing"></a>MFC で埋め込み先サイズ変更のサポート

MFC は、OLE 2 の仕様」の説明に従って完全インプレースでサイズ変更のインターフェイスを実装します。 によって、ユーザー インターフェイスがサポートされている、`COleResizeBar`クラス、カスタム メッセージ WM_SIZECHILD、および特別な処理では、このメッセージの`COleIPFrameWnd`します。

フレームワークによって提供されるよりもこのメッセージのさまざまな処理を実装することがあります。 前述のように、フレームワークのままインプレースがコンテナーまでサイズ変更の結果、サーバーは、倍率の変更に応答します。 場合は、両方を設定して、コンテナーが反応コンテナー エクステントおよび位置の四角形の処理中にその`COleClientItem::OnChangeItemPosition`(への呼び出しの結果として呼び出さ`COleServerDoc::RequestPositionChange`)、編集中の「増減」項目の表示中に、インプレースでサイズ変更が発生し、ウィンドウです。 場合の処理中に四角形の位置を設定するだけで、コンテナーが反応`COleClientItem::OnChangeItemPosition`ズームの倍率を変更、および「拡大または縮小します」、アイテムを表示します。

サーバーは、このネゴシエーション中に起きて (ある程度) を制御できます。 たとえば、スプレッドシートは、セルを表示するまたはより少ないユーザーが項目の編集中に、ウィンドウをサイズ変更時に、インプレース変える必要があります。 ワード プロセッサは、「余白」を変更するため、ウィンドウと同じされていて、新しい余白の折り返しを変える必要があります。 サーバーが自然な範囲を変更することでこれを実装 (から返されたサイズ`COleServerItem::OnGetExtent`)、サイズ変更が完了するとします。 これは、位置四角形とで同じ倍率が大きくまたは小さく表示領域は、同じ量だけを変更するコンテナーのエクステントの両方により、します。 さらに、多少のドキュメントに表示されるによって生成されたメタファイル`OnDraw`します。 この場合、ユーザーに表示する領域だけではなく、項目がサイズ変更時に、ドキュメント自体は変更されます。

カスタムのサイズ変更を実装してによって提供されるユーザー インターフェイスを活用`COleResizeBar`WM_SIZECHILD のメッセージをオーバーライドすることで、`COleIPFrameWnd`クラス。 WM_SIZECHILD の詳細については、次を参照してください。[テクニカル ノート 24](../mfc/tn024-mfc-defined-messages-and-resources.md)します。

## <a name="see-also"></a>関連項目

[番号順テクニカル ノート](../mfc/technical-notes-by-number.md)<br/>
[カテゴリ別テクニカル ノート](../mfc/technical-notes-by-category.md)
