---
title: 翻訳単位とリンケージ (C++)
ms.date: 12/11/2019
ms.assetid: a6493ba0-24e2-4c89-956e-9da1dea660cb
ms.openlocfilehash: dcd66b454da3758996fe827581fe4a73a641407f
ms.sourcegitcommit: a5fa9c6f4f0c239ac23be7de116066a978511de7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/20/2019
ms.locfileid: "75301354"
---
# <a name="translation-units-and-linkage"></a>翻訳単位とリンケージ

C++プログラムでは、変数名や関数名などの*シンボル*は、スコープ内で任意の回数宣言できますが、1回だけ定義できます。 このルールは "1 つの定義ルール" (ODR) です。 *宣言*によって、プログラムに名前が導入 (または再導入) されます。 *定義*には名前が導入されています。 名前が変数を表している場合は、定義によって明示的に初期化されます。 *関数定義*は、シグネチャと関数本体で構成されます。 クラス定義は、クラス名の後に、すべてのクラスメンバーを一覧表示するブロックで構成されます。 (メンバー関数の本体は、必要に応じて別のファイルで個別に定義できます)。

次の例は、いくつかの宣言を示しています。

```cpp
int i;
int f(int x);
class C;
```

次の例では、いくつかの定義を示します。

```cpp
int i{42};
int f(int x){ return x * i; }
class C {
public:
   void DoSomething();
};
```

プログラムは、1つまたは複数の*翻訳単位*で構成されます。 翻訳単位は、実装ファイルと、それに直接または間接的に含まれるすべてのヘッダーで構成されます。 実装ファイルには、通常、 *cpp*または *.cxx*というファイル拡張子が付いています。 ヘッダーファイルには、通常、 *h*または*含め*の拡張子が付いています。 各翻訳単位は、コンパイラによって個別にコンパイルされます。 コンパイルが完了すると、リンカーはコンパイルされた翻訳単位を1つの*プログラム*にマージします。 通常、ODR ルールの違反はリンカーエラーとして表示されます。 異なる翻訳単位に2つの異なる定義がある場合、リンカーエラーが発生します。

一般に、複数のファイルにわたって変数を表示する最善の方法は、ヘッダーファイルに変数を配置することです。 次に、宣言を必要とするすべての*cpp*ファイルに #include ディレクティブを追加します。 ヘッダーの内容に*include ガード*を追加することで、宣言する名前が1回だけ定義されるようにします。

C++ 20 では、[モジュール](modules-cpp.md)はヘッダーファイルの代替手段として導入されました。

場合によっては、 *cpp*ファイルでグローバル変数またはグローバルクラスを宣言する必要があります。 そのような場合は、コンパイラとリンカーに対して、名前に含まれている*リンケージ*の種類を指定する方法が必要です。 リンケージの種類は、オブジェクトの名前を1つのファイルにのみ適用するか、すべてのファイルに適用するかを指定します。 リンケージの概念は、グローバル名にのみ適用されます。 リンケージの概念は、スコープ内で宣言されている名前には適用されません。 スコープは、関数やクラス定義など、外側の中かっこのセットによって指定されます。

## <a name="external-vs-internal-linkage"></a>外部リンケージと内部リンケージ

*Free 関数*は、グローバルまたは名前空間スコープで定義される関数です。 非 const グローバル変数と free 関数は、既定で*外部リンケージ*を持ちます。これらは、プログラム内の翻訳単位から表示されます。 そのため、その名前を持つことができるグローバルオブジェクトはありません。 *内部リンケージ*を持つシンボルまたは*リンケージがない*シンボルは、宣言されている翻訳単位内でのみ表示されます。 名前に内部リンケージがある場合、同じ名前が別の翻訳単位に存在する可能性があります。 クラス定義または関数本体で宣言された変数にはリンケージがありません。

内部リンケージが明示的として宣言することである、グローバル名を強制する**static**します。 これにより、その可視性は、宣言されているのと同じ翻訳単位に限定されます。 このコンテキストでは、 **static**はローカル変数に適用される場合とは異なることを意味します。

次のオブジェクトには、内部リンケージが既定で含まれています。
- const オブジェクト
- constexpr オブジェクト
- typedef
- 名前空間スコープ内の静的オブジェクト

Const オブジェクトの外部リンケージを指定するには、それを**extern**として宣言し、値を割り当てます。

```cpp
extern const int value = 42;
```

詳細については、「 [extern](extern-cpp.md) 」を参照してください。

## <a name="see-also"></a>関連項目

[基本的な概念](../cpp/basic-concepts-cpp.md)