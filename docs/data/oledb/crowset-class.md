---
title: CRowset クラス
ms.date: 11/04/2016
f1_keywords:
- ATL.CRowset<TAccessor>
- CRowset
- ATL::CRowset
- ATL::CRowset<TAccessor>
- ATL.CRowset
- CRowset<TAccessor>.AddRefRows
- CRowset.AddRefRows
- ATL.CRowset.AddRefRows
- AddRefRows
- CRowset::AddRefRows
- CRowset<TAccessor>::AddRefRows
- ATL::CRowset::AddRefRows
- ATL.CRowset<TAccessor>.AddRefRows
- ATL::CRowset<TAccessor>::AddRefRows
- CRowset::Close
- ATL.CRowset.Close
- CRowset<TAccessor>::Close
- CRowset<TAccessor>.Close
- ATL.CRowset<TAccessor>.Close
- ATL::CRowset::Close
- ATL::CRowset<TAccessor>::Close
- CRowset.Close
- CRowset<TAccessor>.Compare
- CRowset<TAccessor>::Compare
- ATL.CRowset<TAccessor>.Compare
- ATL::CRowset<TAccessor>::Compare
- CRowset.Compare
- ATL::CRowset::Compare
- ATL.CRowset.Compare
- CRowset::Compare
- CRowset<TAccessor>::CRowset
- CRowset.CRowset
- ATL::CRowset::CRowset
- ATL::CRowset<TAccessor>::CRowset
- ATL.CRowset.CRowset
- CRowset
- CRowset<TAccessor>.CRowset
- CRowset::CRowset
- ATL.CRowset<TAccessor>.CRowset
- ATL::CRowset::Delete
- CRowset.Delete
- CRowset::Delete
- ATL.CRowset.Delete
- ATL::CRowset<TAccessor>::Delete
- CRowset<TAccessor>.Delete
- CRowset<TAccessor>::Delete
- ATL.CRowset<TAccessor>.Delete
- ATL.CRowset.FindNextRow
- CRowset<TAccessor>.FindNextRow
- ATL::CRowset::FindNextRow
- CRowset::FindNextRow
- CRowset<TAccessor>::FindNextRow
- CRowset.FindNextRow
- ATL.CRowset<TAccessor>.FindNextRow
- ATL::CRowset<TAccessor>::FindNextRow
- FindNextRow
- ATL::CRowset::GetApproximatePosition
- ATL::CRowset<TAccessor>::GetApproximatePosition
- CRowset.GetApproximatePosition
- CRowset::GetApproximatePosition
- GetApproximatePosition
- ATL.CRowset.GetApproximatePosition
- CRowset<TAccessor>::GetApproximatePosition
- CRowset<TAccessor>::GetData
- ATL::CRowset<TAccessor>::GetData
- ATL::CRowset::GetData
- ATL.CRowset<TAccessor>.GetData
- CRowset<TAccessor>.GetData
- CRowset::GetData
- CRowset.GetData
- ATL.CRowset.GetData
- CRowset<TAccessor>::GetDataHere
- CRowset<TAccessor>.GetDataHere
- CRowset.GetDataHere
- GetDataHere
- CRowset::GetDataHere
- ATL::CRowset::GetDataHere
- ATL::CRowset<TAccessor>::GetDataHere
- ATL.CRowset<TAccessor>.GetDataHere
- ATL.CRowset.GetDataHere
- ATL.CRowset<TAccessor>.GetOriginalData
- CRowset<TAccessor>::GetOriginalData
- GetOriginalData
- ATL::CRowset<TAccessor>::GetOriginalData
- ATL.CRowset.GetOriginalData
- CRowset::GetOriginalData
- ATL::CRowset::GetOriginalData
- CRowset.GetOriginalData
- CRowset.GetRowStatus
- ATL.CRowset<TAccessor>.GetRowStatus
- ATL::CRowset<TAccessor>::GetRowStatus
- CRowset::GetRowStatus
- ATL::CRowset::GetRowStatus
- CRowset<TAccessor>::GetRowStatus
- ATL.CRowset.GetRowStatus
- CRowset<TAccessor>.GetRowStatus
- GetRowStatus
- ATL.CRowset<TAccessor>.Insert
- CRowset.Insert
- CRowset<TAccessor>.Insert
- CRowset<TAccessor>::Insert
- ATL::CRowset<TAccessor>::Insert
- ATL.CRowset.Insert
- CRowset::Insert
- ATL::CRowset::Insert
- CRowset::IsSameRow
- CRowset.IsSameRow
- IsSameRow
- ATL::CRowset::IsSameRow
- ATL.CRowset.IsSameRow
- CRowset<TAccessor>::IsSameRow
- ATL.CRowset<TAccessor>.IsSameRow
- CRowset<TAccessor>.IsSameRow
- ATL::CRowset<TAccessor>::IsSameRow
- CRowset<TAccessor>::MoveFirst
- ATL::CRowset::MoveFirst
- CRowset<TAccessor>.MoveFirst
- CRowset::MoveFirst
- CRowset.MoveFirst
- ATL.CRowset.MoveFirst
- ATL.CRowset<TAccessor>.MoveFirst
- ATL::CRowset<TAccessor>::MoveFirst
- ATL::CRowset<TAccessor>::MoveLast
- CRowset<TAccessor>::MoveLast
- ATL.CRowset.MoveLast
- ATL::CRowset::MoveLast
- CRowset<TAccessor>.MoveLast
- MoveLast
- CRowset::MoveLast
- ATL.CRowset<TAccessor>.MoveLast
- CRowset.MoveLast
- ATL.CRowset<TAccessor>.MoveNext
- ATL.CRowset.MoveNext
- ATL::CRowset<TAccessor>::MoveNext
- CRowset<TAccessor>.MoveNext
- CRowset.MoveNext
- CRowset<TAccessor>::MoveNext
- CRowset::MoveNext
- ATL::CRowset::MoveNext
- CRowset<TAccessor>.MovePrev
- CRowset.MovePrev
- MovePrev
- CRowset::MovePrev
- ATL.CRowset.MovePrev
- ATL::CRowset<TAccessor>::MovePrev
- ATL::CRowset::MovePrev
- ATL.CRowset<TAccessor>.MovePrev
- CRowset<TAccessor>::MovePrev
- ATL::CRowset::MoveToBookmark
- ATL::CRowset<TAccessor>::MoveToBookmark
- ATL.CRowset.MoveToBookmark
- ATL.CRowset<TAccessor>.MoveToBookmark
- MoveToBookmark
- CRowset::MoveToBookmark
- CRowset.MoveToBookmark
- CRowset<TAccessor>::MoveToBookmark
- MoveToRatio
- CRowset<TAccessor>::MoveToRatio
- CRowset::MoveToRatio
- CRowset<TAccessor>.MoveToRatio
- ATL.CRowset.MoveToRatio
- ATL::CRowset::MoveToRatio
- CRowset.MoveToRatio
- ATL.CRowset<TAccessor>.MoveToRatio
- ATL::CRowset<TAccessor>::MoveToRatio
- ReleaseRows
- CRowset::ReleaseRows
- ATL::CRowset<TAccessor>::ReleaseRows
- CRowset<TAccessor>.ReleaseRows
- CRowset.ReleaseRows
- ATL.CRowset.ReleaseRows
- ATL.CRowset<TAccessor>.ReleaseRows
- CRowset<TAccessor>::ReleaseRows
- ATL::CRowset::ReleaseRows
- ATL.CRowset<TAccessor>.SetData
- SetData
- ATL::CRowset::SetData
- CRowset<TAccessor>.SetData
- CRowset::SetData
- ATL.CRowset.SetData
- CRowset.SetData
- CRowset<TAccessor>::SetData
- ATL::CRowset<TAccessor>::SetData
- CRowset.Undo
- ATL::CRowset<TAccessor>::Undo
- CRowset<TAccessor>::Undo
- ATL.CRowset.Undo
- ATL.CRowset<TAccessor>.Undo
- CRowset<TAccessor>.Undo
- ATL::CRowset::Undo
- CRowset::Undo
- Undo
- CRowset.Update
- ATL.CRowset.Update
- ATL.CRowset<TAccessor>.Update
- ATL::CRowset<TAccessor>::Update
- CRowset<TAccessor>::Update
- CRowset::Update
- CRowset<TAccessor>.Update
- ATL::CRowset::Update
- CRowset::UpdateAll
- ATL.CRowset.UpdateAll
- CRowset<TAccessor>.UpdateAll
- ATL.CRowset<TAccessor>.UpdateAll
- UpdateAll
- CRowset.UpdateAl
- ATL::CRowset<TAccessor>::UpdateAll
- CRowset<TAccessor>::UpdateAll
- ATL::CRowset::UpdateAll
helpviewer_keywords:
- CRowset class
- AddRefRows method
- Close method
- Compare method
- CRowset class, constructor
- Delete method
- FindNextRow method
- GetApproximatePosition method
- GetData method [OLE DB]
- GetDataHere method
- GetOriginalData method
- GetRowStatus method
- Insert method
- IsSameRow method
- MoveFirst method
- MoveLast method
- MoveNext method
- MovePrev method
- MoveToBookmark method
- MoveToRatio method
- ReleaseRows method
- SetData method
- Undo method
- Update method
- UpdateAll method
ms.assetid: b0228a90-b8dd-47cc-b397-8d4c15c1e7f4
ms.openlocfilehash: dc4f619fb0dba924693682c927247e809fe2cfe9
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "62361969"
---
# <a name="crowset-class"></a>CRowset クラス

OLE DB 行セット オブジェクトと関連するいくつかをカプセル化インターフェイスし、行セットのデータの操作メソッドを提供します。

## <a name="syntax"></a>構文

```cpp
template <class TAccessor = CAccessorBase>
class CRowset
```

### <a name="parameters"></a>パラメーター

*TAccessor*<br/>
アクセサー クラス。 既定値は `CAccessorBase` です。

## <a name="requirements"></a>必要条件

**ヘッダー:** atldbcli.h

## <a name="members"></a>メンバー

### <a name="methods"></a>メソッド

|||
|-|-|
|[AddRefRows](#addrefrows)|現在の行に関連付けられている参照カウントをインクリメントします。|
|[閉じる](#close)|行と、現在のリリース`IRowset`インターフェイス。|
|[Compare](#compare)|使用してをブックマーク 2 つ比較[IRowsetLocate::Compare](/previous-versions/windows/desktop/ms709539(v=vs.85))します。|
|[CRowset](#crowset)|新たに作成`CRowset`オブジェクトし、(必要に応じて) に関連付けます、`IRowset`インターフェイスのパラメーターとして指定します。|
|[削除](#delete)|使用して、行セットから行を削除[IRowsetChange:DeleteRows](/previous-versions/windows/desktop/ms724362(v=vs.85))します。|
|[FindNextRow](#findnextrow)|指定されたブックマーク後に、次の一致する行を検索します。|
|[GetApproximatePosition](#getapproximateposition)|ブックマークに対応する行のおおよその位置を返します。|
|[GetData](#getdata)|行の行セットのコピーからデータを取得します。|
|[GetDataHere](#getdatahere)|指定したバッファーからデータを取得します。|
|[GetOriginalData](#getoriginaldata)|最近からフェッチまたは保留中の変更を無視して、データ ソースに送信されるデータを取得します。|
|[GetRowStatus](#getrowstatus)|すべての行の状態を返します。|
|[[挿入]](#insert)|作成を使用して新しい行を挿入します[IRowsetChange:InsertRow](/previous-versions/windows/desktop/ms716921(v=vs.85))します。|
|[IsSameRow](#issamerow)|現在の行に指定された行を比較します。|
|[MoveFirst](#movefirst)|次のフェッチ位置を初期位置に移動します。|
|[MoveLast](#movelast)|最後のレコードに移動します。|
|[MoveNext](#movenext)|次のシーケンスの行または指定された数の次の行を超える位置からのデータをフェッチします。|
|[MovePrev](#moveprev)|前のレコードに移動します。|
|[MoveToBookmark](#movetobookmark)|ブックマークからブックマークで行または指定したオフセットの行をフェッチします。|
|[MoveToRatio](#movetoratio)|行セット内の小数部の位置から始まる行がフェッチされます。|
|[ReleaseRows](#releaserows)|呼び出し[::releaserows](/previous-versions/windows/desktop/ms719771(v=vs.85))を現在の行ハンドルを解放します。|
|[SetData](#setdata)|使用して行の 1 つまたは複数の列のデータ値を設定[IRowsetChange:SetData](/previous-versions/windows/desktop/ms721232(v=vs.85))します。|
|[元に戻す](#undo)|最後のフェッチを行に加えられた変更を元に戻しますか[Update](../../data/oledb/crowset-update.md)します。|
|[更新](#update)|保留中の最後のフェッチまたは更新プログラム以降、現在の行に加えられた変更を送信します。|
|[UpdateAll](#updateall)|保留中の最後のフェッチまたは更新プログラム以降のすべての行に加えられた変更を送信します。|

## <a name="remarks"></a>Remarks

OLE DB では、行セットは、プログラムにより設定し、データを取得オブジェクトです。

このクラスがインスタンス化されますが、テンプレートのパラメーターとしてではなく渡されたものではありません`CTable`または`CCommand`(`CRowset`は既定です)。

## <a name="addrefrows"></a> CRowset::AddRefRows

呼び出し[IRowset::AddRefRows](/previous-versions/windows/desktop/ms719619(v=vs.85)) (1 つ) によって参照カウントをインクリメントするは、現在の行ハンドルに関連付けられています。

### <a name="syntax"></a>構文

```cpp
HRESULT AddRefRows() throw();
```

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドは、現在の行ハンドルの参照カウントをインクリメントします。 呼び出す[ReleaseRows](../../data/oledb/crowset-releaserows.md)カウントをデクリメントします。 Move メソッドによって返される行では、1 つの参照カウントがあります。

## <a name="close"></a> Crowset::close

行と、現在のリリース[IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85))インターフェイス。

### <a name="syntax"></a>構文

```cpp
void Close() throw();
```

### <a name="remarks"></a>Remarks

このメソッドは、現在、行セット内のすべての行を解放します。

## <a name="compare"></a> Crowset::compare

使用してをブックマーク 2 つ比較[IRowsetLocate::Compare](/previous-versions/windows/desktop/ms709539(v=vs.85))します。

### <a name="syntax"></a>構文

```cpp
HRESULT Compare(const CBookmarkBase& bookmark1,
   const CBookmarkBase& bookmark2,
   DBCOMPARE* pComparison) const throw();
```

#### <a name="parameters"></a>パラメーター

*Bookmark1*<br/>
[in]比較する最初のブックマーク。

*Bookmark2*<br/>
[in]比較する 2 番目のブックマーク。

*pComparison*<br/>
[out]比較の結果へのポインター。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドでは省略可能なインターフェイス`IRowsetLocate`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetLocate`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

コンシューマーでのブックマークの使用方法の詳細については、次を参照してください。[ブックマークを使って](../../data/oledb/using-bookmarks.md)します。

## <a name="crowset"></a> Crowset::crowset

新たに作成`CRowset`オブジェクトし、(必要に応じて) に関連付けます、 [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85))インターフェイスのパラメーターとして指定します。

### <a name="syntax"></a>構文

```cpp
CRowset();

CRowset(IRowset* pRowset);
```

#### <a name="parameters"></a>パラメーター

*pRowset*<br/>
[in]ポインター、`IRowset`このクラスに関連するインターフェイス。

## <a name="delete"></a> Crowset::delete

呼び出し[irowsetchange::deleterows](/previous-versions/windows/desktop/ms724362(v=vs.85))を行セットから現在の行を削除します。

### <a name="syntax"></a>構文

```cpp
HRESULT Delete() const throw();
```

### <a name="return-value"></a>戻り値

標準の HRESULT です。

## <a name="findnextrow"></a> CRowset::FindNextRow

指定されたブックマーク後に、次の一致する行を検索します。

### <a name="syntax"></a>構文

```cpp
HRESULT FindNextRow(DBCOMPAREOP op,
   BYTE* pData,
   DBTYPE wType,
   DBLENGTH nLength,
   BYTE bPrecision,
   BYTE bScale,
   BOOL bSkipCurrent = TRUE,
   CBookmarkBase* pBookmark = NULL) throw();
```

#### <a name="parameters"></a>パラメーター

*op*<br/>
[in]行の値を比較する際に使用する操作。 値については、次を参照してください。 [:findnextrow](/previous-versions/windows/desktop/ms723091(v=vs.85))します。

*pData*<br/>
[in]一致する値へのポインター。

*wType*<br/>
[in]バッファーの値の一部のデータ型を示します。 型インジケーターの詳細については、次を参照してください。[データ型](/previous-versions/windows/desktop/ms723969(v=vs.85))で、 *OLE DB プログラマーズ リファレンス*Windows SDK に含まれています。

*nLength*<br/>
[in]データの値として割り当てられているコンシューマー データ構造体の長さ、(バイト単位)。 詳細については、説明を参照してください。`cbMaxLen`で[DBBINDING 構造体](/previous-versions/windows/desktop/ms716845(v=vs.85))で、 *OLE DB プログラマーズ リファレンス。*

*bPrecision*<br/>
[in]データを取得するときに使用される最大有効桁数。 使用されている場合にのみ*wType* DBTYPE_NUMERIC です。 詳細については、次を参照してください。 [DBTYPE_NUMERIC または DBTYPE_DECIMAL を伴う変換](/previous-versions/windows/desktop/ms719714(v=vs.85))で、 *OLE DB プログラマーズ リファレンス*します。

*bScale*<br/>
[in]データの取得時に使用されるスケール。 使用されている場合にのみ*wType* DBTYPE_NUMERIC DBTYPE_DECIMAL か。 詳細については、次を参照してください。 [DBTYPE_NUMERIC または DBTYPE_DECIMAL を伴う変換](/previous-versions/windows/desktop/ms719714(v=vs.85))で、 *OLE DB プログラマーズ リファレンス*します。

*bSkipCurrent*<br/>
[in]検索を開始する位置のブックマークからの行の数。

*pBookmark*<br/>
[in]検索を開始する位置をブックマークします。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドでは省略可能なインターフェイス`IRowsetFind`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetFind`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

コンシューマーでのブックマークの使用方法の詳細については、次を参照してください。[ブックマークを使って](../../data/oledb/using-bookmarks.md)します。

## <a name="getapproximateposition"></a> Crowset::getapproximateposition

ブックマークに対応する行のおおよその位置を返します。

### <a name="syntax"></a>構文

```cpp
HRESULT GetApproximatePosition(const CBookmarkBase* pBookmark,
   DBCOUNTITEM* pPosition,
   DBCOUNTITEM* pcRows) throw();
```

#### <a name="parameters"></a>パラメーター

*pBookmark*<br/>
[in]位置を検索する行を識別するブックマークへのポインター。 行の数が必要なだけの場合は NULL です。

*pPosition*<br/>
[out]場所へのポインター、`GetApproximatePosition`行の位置を返します。 位置が必要ない場合は NULL です。

*pcRows*<br/>
[out]場所へのポインター、`GetApproximatePosition`行の合計数を返します。 行の数が必要ない場合は NULL です。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドでは省略可能なインターフェイス`IRowsetScroll`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetScroll`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

コンシューマーでのブックマークの使用方法の詳細については、次を参照してください。[ブックマークを使って](../../data/oledb/using-bookmarks.md)します。

## <a name="getdata"></a> Crowset::getdata

行の行セットのコピーからデータを取得します。

### <a name="syntax"></a>構文

```cpp
HRESULT GetData() throw();

HRESULT GetData(int nAccessor) throw();
```

#### <a name="parameters"></a>パラメーター

*nAccessor*<br/>
[in]データにアクセスするのに使用するアクセサーの (ゼロ オフセット) のインデックス番号。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

自動アクセサーではないアクセサーを指定するかどうかは[BEGIN_ACCESSOR](../../data/oledb/begin-accessor.md)、このメソッドを使用して明示的にアクセサーの数を渡すことで、データを取得します。

## <a name="getdatahere"></a> Crowset::getdatahere

現在の行からデータを取得し、指定されたバッファーにします。

### <a name="syntax"></a>構文

```cpp
HRESULT GetDataHere(int nAccessor,
   void* pBuffer) throw();
```

#### <a name="parameters"></a>パラメーター

*nAccessor*<br/>
[in]データにアクセスするのに使用するアクセサーのインデックス番号。

*pBuffer*<br/>
[out]現在のレコードのデータを配置するバッファー。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

この関数を使用する方法の例は、次を参照してください。、 [MultiRead サンプル](../../overview/visual-cpp-samples.md)します。

## <a name="getoriginaldata"></a> CRowset::GetOriginalData

呼び出し`IRowsetUpdate::GetOriginalData`最近からフェッチまたはデータ ソースに送信されるデータを取得します。

### <a name="syntax"></a>構文

```cpp
HRESULT GetOriginalData() throw();
```

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドから最も最近フェッチまたはデータ ソースに送信されるデータを取得します保留中の変更に基づく値は取得しません。

このメソッドでは省略可能なインターフェイス`IRowsetUpdate`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetUpdate`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

## <a name="getrowstatus"></a> Crowset::getrowstatus

すべての行の状態を返します。

### <a name="syntax"></a>構文

```cpp
HRESULT GetRowStatus(DBPENDINGSTATUS* pStatus) const throw();
```

#### <a name="parameters"></a>パラメーター

*pStatus*<br/>
[out]場所へのポインターを`GetRowStatus`ステータス値を返します。 OLE DB プログラマーズ リファレンス DBPENDINGSTATUS を参照してください。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドでは省略可能なインターフェイス`IRowsetUpdate`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetUpdate`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

## <a name="insert"></a> Crowset::insert

作成し、データ アクセサーを使用して新しい行を初期化します。

### <a name="syntax"></a>構文

```cpp
HRESULT Insert(int nAccessor = 0,
   bool bGetHRow = false) throw();
```

#### <a name="parameters"></a>パラメーター

*nAccessor*<br/>
[in]データを挿入するために使用するアクセサーの数。

*bGetHRow*<br/>
[in]挿入された行のハンドルを取得するかどうかを示します。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドでは省略可能なインターフェイス`IRowsetChange`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetChange`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

1 つまたは複数の列が書き込み可能な場合、挿入が失敗することがあります。 これを修正するにはカーソル マップを変更します。

### <a name="example"></a>例

次の例では、データ ソースにアクセスできる行セットを使用し、その行セットのテーブルを使用して文字列を挿入する方法を示します。

最初に、プロジェクトに新しい ATL オブジェクトを挿入することで、テーブル クラスを作成します。 たとえば、ワークスペース ウィンドウでプロジェクトを右クリックし、選択**ATL オブジェクトの新しい**します。 **データ アクセス**カテゴリで、**コンシューマー**します。 型のコンシューマー オブジェクトを作成する**テーブル**します。 (選択**テーブル**テーブルから直接、行セットを作成します選択**コマンド**SQL コマンドからの行セットを作成します。)。そのデータ ソースへのアクセスに使用するテーブルを指定する、データ ソースを選択します。 コンシューマーのオブジェクトを呼び出す場合**CCustomerTable**、挿入コードを次のように、実装は。

[!code-cpp[NVC_OLEDB_Consumer#10](../../data/oledb/codesnippet/cpp/crowset-insert_1.cpp)]

## <a name="issamerow"></a> CRowset::IsSameRow

現在の行に指定された行を比較します。

### <a name="syntax"></a>構文

```cpp
HRESULT IsSameRow(HROW hRow) const throw();
```

#### <a name="parameters"></a>パラメーター

*hRow*<br/>
[in]現在の行と比較する行へのハンドル。

### <a name="return-value"></a>戻り値

標準の HRESULT です。 S_OK では、行は、同じことを示します。 その他の値では、次を参照してください。 [IRowsetIndentity::IsSameRow](/previous-versions/windows/desktop/ms719629(v=vs.85))で、 *OLE DB プログラマーズ リファレンス*Windows SDK にします。

## <a name="movefirst"></a> CRowset::MoveFirst

最初の位置にカーソルを移動し、最初の行を取得します。

### <a name="syntax"></a>構文

```cpp
HRESULT MoveFirst() throw();
```

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

呼び出し[irowset::restartposition](/previous-versions/windows/desktop/ms712877(v=vs.85))位置を初期位置 (行セットの作成時に、次のフェッチ位置が位置) に次のフェッチ位置を変更して、最初の行を取得します。

## <a name="movelast"></a> CRowset::MoveLast

最後の行にカーソルを移動します。

### <a name="syntax"></a>構文

```cpp
HRESULT MoveLast() throw();
```

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

呼び出し[irowset::restartposition](/previous-versions/windows/desktop/ms712877(v=vs.85))次のフェッチ位置を最後の位置に配置し、最後の行を取得します。

このメソッドは、設定する必要があります`DBPROP_CANSCROLLBACKWARDS`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。 (パフォーマンスの向上のため、設定することがありますも`DBPROP_QUICKRESTART`を VARIANT_TRUE に設定します)。

## <a name="movenext"></a> CRowset::MoveNext

次のレコードにカーソルを移動します。

### <a name="syntax"></a>構文

```cpp
HRESULT MoveNext() throw();

HRESULT MoveNext(LONG lSkip,
   bool bForward= true) throw();
```

#### <a name="parameters"></a>パラメーター

*した*<br/>
[in]フェッチする前にスキップする行の数。

*bForward*<br/>
[in]渡す**true**前方に次のレコードに移動する**false**後方移動します。

### <a name="return-value"></a>戻り値

標準の HRESULT です。 行セットの末尾に達している場合は、DB_S_ENDOFROWSET を返します。

### <a name="remarks"></a>Remarks

次の連続した行をフェッチ、`CRowset`オブジェクトは、前の位置を記憶します。 必要に応じて、前方にスキップすることができます*した*行または旧バージョンと移動します。

このメソッドは、呼び出す前に、次のプロパティを設定する必要があります`Open`テーブルまたは行セットを格納しているコマンド。

- `DBPROP_CANSCROLLBACKWARDS` 場合は VARIANT_TRUE をする必要があります*した*< 0

- `DBPROP_CANFETCHBACKWARDS` 場合は VARIANT_TRUE をする必要があります*bForward* = false

それ以外の場合 (場合*した*> = 0 と*bForward* = true)、その他のプロパティを設定する必要はありません。

## <a name="moveprev"></a> CRowset::MovePrev

前のレコードには、カーソルを移動します。

### <a name="syntax"></a>構文

```cpp
HRESULT MovePrev() throw();
```

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドは、いずれかを設定することが必要です`DBPROP_CANFETCHBACKWARDS`または`DBPROP_CANSCROLLBACKWARDS`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

## <a name="movetobookmark"></a> Crowset::movetobookmark

ブックマークまたは、指定したオフセットの行でマークされた行をフェッチ (*した*)、そのブックマークから。

### <a name="syntax"></a>構文

```cpp
HRESULT MoveToBookmark(const CBookmarkBase& bookmark,
   LONG lSkip = 0) throw();
```

#### <a name="parameters"></a>パラメーター

*ブックマーク*<br/>
[in]データをフェッチする位置を示すブックマーク。

*した*<br/>
[in]対象の行にブックマークからの行の数。 場合*した*0 の場合は、フェッチされる最初の行は、ブックマークが設定された行。 場合*した*は 1 です。 最初の行がフェッチされた行の直後、行は、します。 場合*した*-1 で、フェッチされる最初の行は、ブックマークが設定された行の前に行。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドでは省略可能なインターフェイス`IRowsetLocate`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetLocate`を VARIANT_TRUE に設定し`DBPROP_CANFETCHBACKWARDS`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

コンシューマーでのブックマークの使用方法の詳細については、次を参照してください。[ブックマークを使って](../../data/oledb/using-bookmarks.md)します。

## <a name="movetoratio"></a> CRowset::MoveToRatio

行セット内の小数部の位置から始まる行がフェッチされます。

### <a name="syntax"></a>構文

```cpp
HRESULT MoveToRatio(DBCOUNTITEM nNumerator,
   DBCOUNTITEM nDenominator,bool bForward = true) throw();
```

#### <a name="parameters"></a>パラメーター

*nNumerator*<br/>
[in]分子の小数部を決定するために使用元となるデータをフェッチする位置を指定します。

*nDenominator*<br/>
[in]分母の小数部を決定するために使用元となるデータをフェッチする位置を指定します。

*bForward*<br/>
[in]前方または後方に移動するかどうかを示します。 既定では転送です。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

`MoveToRatio` ほぼ次の数式に従って行がフェッチされます。

`(nNumerator *  RowsetSize ) / nDenominator`

場所`RowsetSize`行数で指定された行セットのサイズです。 この式の精度は、特定のプロバイダーによって異なります。 詳細については、次を参照してください。 [irowsetscroll::getrowsatratio](/previous-versions/windows/desktop/ms709602(v=vs.85))します。

このメソッドでは省略可能なインターフェイス`IRowsetScroll`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetScroll`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

## <a name="releaserows"></a> CRowset::ReleaseRows

呼び出し[::releaserows](/previous-versions/windows/desktop/ms719771(v=vs.85))を現在の行ハンドルを解放します。

### <a name="syntax"></a>構文

```cpp
HRESULT ReleaseRows() throw();
```

### <a name="return-value"></a>戻り値

標準の HRESULT です。

## <a name="setdata"></a> Crowset::setdata

行の 1 つまたは複数の列のデータ値を設定します。

### <a name="syntax"></a>構文

```cpp
HRESULT SetData() const throw();

HRESULT SetData(int nAccessor) const throw();
```

#### <a name="parameters"></a>パラメーター

*nAccessor*<br/>
[in]データにアクセスするのに使用するアクセサーの数。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

`SetData`を引数なしですべてのアクセサーを受け入れるフォームは更新に使用します。 通常`SetData`行内の列のデータ値を設定するにし、呼び出す[更新](../../data/oledb/crowset-update.md)それらの変更を送信します。

このメソッドでは省略可能なインターフェイス`IRowsetChange`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetChange`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

設定操作は、1 つまたは複数の列が書き込み可能な場合に失敗する可能性があります。 これを修正するにはカーソル マップを変更します。

## <a name="undo"></a> Crowset::undo

最後のフェッチを行に加えられた変更を元に戻しますか[Update](../../data/oledb/crowset-update.md)します。

### <a name="syntax"></a>構文

```cpp
HRESULT Undo(DBCOUNTITEM* pcRows = NULL,
   HROW* phRow = NULL,
   DBROWSTATUS* pStatus = NULL) throw();
```

#### <a name="parameters"></a>パラメーター

*pcRows*<br/>
[out]場所へのポインター、`Undo`しようとするために必要な場合に元に戻す行の数を返します。

*phRow*<br/>
[out]場所へのポインター、`Undo`に必要な場合に元に戻すしようとしたすべての行ハンドルの配列を返します。

*pStatus*<br/>
[out]場所へのポインター、`Undo`行の状態値を返します。 場合の状態が返されない*pStatus*が null です。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

このメソッドでは省略可能なインターフェイス`IRowsetUpdate`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetUpdate`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

## <a name="update"></a> Crowset::update

保留中の最後のフェッチ、現在の行に加えられた変更を送信または`Update`を呼び出します。

### <a name="syntax"></a>構文

```cpp
HRESULT Update(DBCOUNTITEM* pcRows = NULL,
   HROW* phRow = NULL,
   DBROWSTATUS* pStatus = NULL) throw();
```

#### <a name="parameters"></a>パラメーター

*pcRows*<br/>
[out]場所へのポインター、`Update`試行されると必要な場合、更新するには行の数を返します。

*phRow*<br/>
[out]場所へのポインター、`Update`を更新しようとした行のハンドルを返します。 場合はハンドルが返されない*phRow*が null です。

*pStatus*<br/>
[out]場所へのポインター、`Update`行の状態値を返します。 場合の状態が返されない*pStatus*が null です。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

### <a name="remarks"></a>Remarks

保留中の行が最後にフェッチまたは更新後に、現在の行に加えられた変更を送信 (を使用して`Update`または[UpdateAll](../../data/oledb/crowset-updateall.md))。 通常[SetData](../../data/oledb/crowset-setdata.md) 、行内の列のデータ値を設定し、呼び出す`Update`をそれらの変更を送信します。

このメソッドでは省略可能なインターフェイス`IRowsetUpdate`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetUpdate`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

## <a name="updateall"></a> Crowset::updateall

保留中の最後のフェッチで、以降のすべての行に加えられた変更を送信または`Update`を呼び出します。

### <a name="syntax"></a>構文

```cpp
HRESULT UpdateAll(DBCOUNTITEM* pcRows = NULL,
   HROW** pphRow = NULL,
   DBROWSTATUS** ppStatus = NULL) throw();
```

#### <a name="parameters"></a>パラメーター

*pcRows*<br/>
[out]場所へのポインター、`UpdateAll`試行されると必要な場合、更新するには行の数を返します。

*pphRow*<br/>
[out]メモリへのポインター`UpdateAll`を更新しようとした行のハンドルを返します。 場合はハンドルが返されない*pphRow*が null です。

*ppStatus*<br/>
[out]場所へのポインター、`Update`行の状態値を返します。 場合の状態が返されない*ppStatus*が null です。

### <a name="remarks"></a>Remarks

保留中のこれらの行が最後にフェッチされた、またはを使用して更新後に、すべての行に加えられた変更を送信[Update](../../data/oledb/crowset-update.md)または`UpdateAll`します。 `UpdateAll` かどうかがあるハンドルに関係なく、変更されたすべての行が更新されます (を参照してください*pphRow*) かどうか。

使用した場合の例の`Insert`行セットでは、5 つの行を挿入するにはいずれかの呼び出しをでした`Update`5 回または呼び出し`UpdateAll`更新すべてを 1 回です。

このメソッドでは省略可能なインターフェイス`IRowsetUpdate`、する可能性がありますでサポートされていないすべてのプロバイダー場合は、この場合、E_NOINTERFACE を返します。 設定する必要がありますも`DBPROP_IRowsetUpdate`を呼び出す前に VARIANT_TRUE に`Open`テーブルまたは行セットを含むコマンド。

### <a name="return-value"></a>戻り値

標準の HRESULT です。

## <a name="see-also"></a>関連項目

[DBViewer サンプル](../../overview/visual-cpp-samples.md)<br/>
[MultiRead サンプル](../../overview/visual-cpp-samples.md)<br/>
[MultiRead 属性のサンプル](../../overview/visual-cpp-samples.md)<br/>
[OLE DB コンシューマー テンプレート](../../data/oledb/ole-db-consumer-templates-cpp.md)<br/>
[OLE DB コンシューマー テンプレート リファレンス](../../data/oledb/ole-db-consumer-templates-reference.md)