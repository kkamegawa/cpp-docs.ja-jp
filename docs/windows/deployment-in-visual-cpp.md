---
title: Visual C++ での配置
ms.date: 05/11/2018
helpviewer_keywords:
- deploying applications [C++]
- application deployment [C++]
ms.assetid: d4b4ffc0-d2bd-4e4a-84a6-62f1c26f6a09
ms.openlocfilehash: 67d5c7b0772eda55d1b653bd73f95ac93e31e644
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/15/2019
ms.locfileid: "69514807"
---
# <a name="deployment-in-visual-c"></a>Visual C++ での配置

開発用コンピューター以外のコンピューターでのアプリケーションのインストールは、*配置*と呼ばれます。 Visual C++ アプリケーションを別のコンピューターに配置する場合、アプリケーションと、アプリケーションが依存するすべてのライブラリ ファイルの両方をインストールする必要があります。 Visual C++ では、*集中配置*、*ローカル配置*、*静的リンク* の 3 つの方法で、アプリケーションと共に Visual C++ ライブラリを配置できます。 集中配置では、Windows ディレクトリの下にライブラリ ファイルが配置されるため、Windows Update サービスで自動的に更新できます。 ローカル配置では、ご利用のアプリケーションと同じディレクトリにライブラリ ファイルが配置されます。 ローカルに配置されたライブラリを自分で再配置して更新する必要があります。 静的リンクでは、ご利用のアプリケーションにライブラリ コードがバインドされます。 静的リンクを使用する際にライブラリの更新プログラムを利用するには、アプリケーションの再コンパイルと再配置が必要になります。

Visual Studio 2015 では、Microsoft C ランタイム ライブラリは、バージョンに固有のローカル ライブラリ コンポーネントと、Windows の一部となった新しい Universal C ランタイム ライブラリにリファクタリングされました。 ユニバーサル CRT の配置の詳細については、「[ユニバーサル CRT の配置](universal-crt-deployment.md)」を参照してください。

## <a name="central-deployment"></a>集中配置

集中配置では、ライブラリ DLL ファイルは Windows\System32 ディレクトリにインストールされます。x64 システムの 32 ビット ライブラリ ファイルの場合は、Windows\SysWow64 ディレクトリにインストールされます。 集中配置されたライブラリは自動的に更新されます。 ローカル配置された、または静的にリンクされた Visual C++ ライブラリについては、更新プログラムを提供する必要があります。

Visual C++ ライブラリを集中配置する場合、インストールするファイルの次の 2 つのソースのいずれかを使用できます。

- *再頒布可能パッケージ* ファイル: 圧縮形式ですべての Visual C++ 再頒布可能ライブラリが含まれるスタンドアロンのコマンド ライン実行可能ファイルです。

- *再頒布可能マージ モジュール* (.msm ファイル): 特定のライブラリを配置する際に使用でき、アプリケーションの Windows インストーラー (.msi) ファイルに含めることができます。

再頒布可能パッケージ ファイルにより、特定のシステム アーキテクチャの Visual C++ ライブラリがすべてインストールされます。 たとえば、アプリケーションが x64 用にビルドされている場合、vcredist_x64.exe 再頒布可能パッケージを使って、アプリケーションで使用される Visual C++ ライブラリをすべてインストールできます。 アプリケーションをインストールする前に必須コンポーネントとして再頒布可能パッケージを実行するように、アプリケーション インストーラーをプログラミングできます。

マージ モジュールにより、Windows インストーラーのアプリケーション セットアップ ファイルに、特定の Visual C++ ライブラリに対するセットアップ ロジックを含めることができます。 このマージ モジュールは、アプリケーションで必要な数だけ含めることができます。 マージ モジュールは、配置バイナリのサイズを最小限に抑える必要がある場合に使用します。

再頒布可能パッケージまたはマージ モジュールを使用する集中配置では、Windows Update で Visual C++ ライブラリを自動的に更新できるため、ご利用のアプリケーションでは静的ライブラリではなくライブラリ DLL を使用し、ローカル配置ではなく集中配置を使用することをお勧めします。

## <a name="local-deployment"></a>ローカル配置

ローカル配置では、ライブラリ ファイルが、実行可能ファイルと共にご利用のアプリケーション フォルダーにインストールされます。 同じフォルダーにさまざまなバージョンの Visual C++ 再頒布可能ライブラリをインストールすることができます。これは、各バージョンのファイル名にバージョン番号が含まれるためです。 たとえば、C++ ランタイム ライブラリのバージョン 12 の場合、msvcp120.dll となり、バージョン 14 の場合は msvcp140.dll となります。

複数の追加 DLL に分散される可能性のあるライブラリは、*ドット ライブラリ* と呼ばれます。 たとえば、msvcp140.dll の ABI 互換性を保持するために、Visual Studio 2017 バージョン 15.6 でリリースされた標準ライブラリの一部の機能は msvcp140_1.dll に追加されました。 Visual Studio 2017 バージョン 15.6 (ツールセット 14.13)、または Visual Studio 2017 のそれ以降のツールセットを使用する場合は、メイン ライブラリだけでなく、これらのドット ライブラリをローカル配置する必要がある場合があります。 ABI が変更されたときに、これらの個々のドット ライブラリは次のメジャー バージョンの基本ライブラリにローリングされます。

ローカル配置された Visual C++ ライブラリは自動更新できないため、このライブラリのローカル配置はお勧めしません。 再頒布可能ライブラリのローカル配置を使用する場合は、ローカル配置されたライブラリを対象とした独自の自動更新方法を実装することをお勧めします。

## <a name="static-linking"></a>静的リンク

動的にリンクされたライブラリに加え、Visual Studio では静的ライブラリとしてほとんどのライブラリが提供されます。 静的ライブラリをご利用のアプリケーションに静的にリンクすることができます。つまり、ライブラリ オブジェクト コードを直接アプリケーションにリンクできます。 これにより、DLL 依存関係のない単一のバイナリが作成されるため、Visual C++ ライブラリ ファイルを個別に配置する必要はありません。 ただし、静的にリンクされたライブラリはその場で更新できないため、このアプローチはお勧めしません。 静的なリンクを使用している場合、リンクされたライブラリを更新するには、アプリケーションを再コンパイルし、再配置する必要があります。

## <a name="troubleshooting-deployment-issues"></a>配置に関する問題のトラブルシューティング

Visual C++ ライブラリの読み込み順序はシステムに依存します。 ローダーの問題を診断するには、depends.exe または where.exe を使用します。 詳細については、[ダイナミック リンク ライブラリの検索順序 (Windows)](/windows/win32/Dlls/dynamic-link-library-search-order) に関するページを参照してください。

## <a name="see-also"></a>関連項目

- [デスクトップ アプリケーションの配置](deploying-native-desktop-applications-visual-cpp.md)
- [ユニバーサル CRT の配置](universal-crt-deployment.md)
